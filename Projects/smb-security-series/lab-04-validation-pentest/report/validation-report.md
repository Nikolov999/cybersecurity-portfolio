# \# Lab 4 — Validation: SMB Credential Abuse Controls

# 

# \## Objective

# 

# Validate that remediation and detection engineering implemented in previous labs

# successfully prevent and expose the original SMB credential abuse attack path.

# 

# This lab replays the initial attack under controlled conditions to measure

# control effectiveness, not attacker success.

# 

# ---

# 

# \## Environment

# 

# \- \*\*Attacker simulation:\*\* Windows 10 (isolated VM)

# \- \*\*Target system:\*\* Windows Server 2022

# \- \*\*Monitoring:\*\* Wazuh agent on Server 2022, Wazuh Manager

# \- \*\*Protocol:\*\* SMB / NTLM

# \- \*\*Tooling:\*\* Native OS utilities and SMB-based execution methods

# 

# No additional instrumentation or rule tuning was introduced for this lab.

# 

# ---

# 

# \## Attack Replay

# 

# The following steps from Lab 1 were repeated:

# 

# 1\. Attempt network authentication using previously exposed credentials

# 2\. Attempt privileged access over SMB

# 3\. Attempt SMB-based remote execution (benign command)

# 

# The same attack path was used to ensure validity of comparison.

# 

# ---

# 

# \## Observed Outcome

# 

# \### Attack Effectiveness

# 

# \- Credential exposure was no longer present

# \- Access to sensitive data was denied or yielded no usable secrets

# \- Remote execution was constrained or blocked

# \- No persistence was established

# 

# The original failure condition could not be reproduced.

# 

# ---

# 

# \## Detection Results

# 

# The following detection chain was observed on the Windows Server:

# 

# 1\. \*\*Network logon detected (Type 3, NTLM/Negotiate)\*\*  

# &nbsp;  Indicates remote authentication over a network protocol.

# 

# 2\. \*\*Privileged logon context assigned (Event 4672)\*\*  

# &nbsp;  Confirms elevated privileges were granted during the session.

# 

# 3\. \*\*New Windows service created (possible remote execution)\*\*  

# &nbsp;  Indicates SMB-based execution behavior consistent with lateral movement.

# 

# These events occurred within a short time window and were observable

# without protocol-specific logging.

# 

# ---

# 

# \## Comparison to Lab 1

# 

# | Category | Lab 1 | Lab 4 |

# |--------|------|------|

# | Credential exposure | Present | Removed |

# | Lateral movement | Successful | Prevented |

# | Detection clarity | Low | High |

# | Analyst effort | Manual reconstruction | Direct correlation |

# | Response scope | Unclear | Minimal and justified |

# 

# ---

# 

# \## Analyst Assessment

# 

# The attack attempt produced a clear behavioral signal despite using

# legitimate credentials and standard protocols.

# 

# Correlation of:

# \- network authentication,

# \- privilege assignment,

# \- and execution artifacts

# 

# allowed the activity to be identified as suspicious without relying on

# signature-based detection.

# 

# ---

# 

# \## Response Decision

# 

# Given the lack of successful execution or persistence:

# \- No containment actions were required

# \- No system isolation was performed

# \- The incident was closed as \*\*attempted but prevented\*\*

# 

# This response was proportional to impact and risk.

# 

# ---

# 

# \## Final Assessment

# 

# This validation confirms that:

# 

# \- The original attack path is no longer viable

# \- Detection engineering produces actionable signal

# \- Analyst confidence is significantly improved

# \- Controls behave as expected under replay conditions

# 

# Lab 4 successfully closes the defensive lifecycle for this scenario.

# 

# ---

# 

# \## Conclusion

# 

# Effective security controls are measured by their behavior under reuse,

# not by theoretical coverage.

# 

# This lab demonstrates prevention, detection, and validation of a

# realistic SMB credential abuse scenario using practical blue-team methods.

