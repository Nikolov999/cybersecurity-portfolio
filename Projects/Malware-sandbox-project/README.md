# ğŸ”¬ Malware Analysis Lab â€“ Safe Simulation Environment  
**File-Based Logging | Registry Persistence | Beaconing Simulation | Sysmon Telemetry**

This project implements a fully safe Windows-based malware simulation lab, designed to study **malware-like behaviors** without using any real malicious code.  
All artifacts are harmless and serve only for detection and analysis training.

## ğŸ§± 1. Overview

This lab simulates three common malware behaviors:

1. **Keylogger-like file write behavior**  
2. **Registry-based persistence mechanism**  
3. **C2-like periodic beaconing behavior**

Detection and telemetry collection are performed using **Sysmon** with the SwiftOnSecurity config.

---

## ğŸ–¥ï¸ 2. Environment Setup

| Component | Details |
|----------|---------|
| OS | Windows Server 2019 / Windows 10 (VM) |
| Monitoring | Sysmon64.exe + SwiftOnSecurity config |
| Languages | Python 3.12, PowerShell |
| Folder | `C:\Sandbox\` |
| Network | Host-only / NAT (sandboxed) |

---

## ğŸ“ 3. Folder Structure


ğŸ“¸ **[PLACEHOLDER â€” Screenshot: C:\Sandbox folder]**

---

# ğŸŸ© 4. Simulation 1 â€” Keylogger-Like Behavior

### ğŸ“Œ Description  
A safe simulation where Python writes synthetic â€œkeystrokesâ€ to a log file every second.

### ğŸ“„ Script  
`fake_keylogger_sim.py`

### ğŸ“ Output  
`C:\Sandbox\logs\fake_keylog.txt`

ğŸ“¸ **[PLACEHOLDER â€” Script running]**  
ğŸ“¸ **[PLACEHOLDER â€” fake_keylog.txt content]**

---

## ğŸ” Sysmon Events for Keylogger

### **Event ID 1 â€” Process Create**
Triggered when python.exe starts the script.

**Expected fields:**
- Image: `python.exe`
- CommandLine: `python fake_keylogger_sim.py`

ğŸ“¸ **[PLACEHOLDER â€” Sysmon EID 1 for python.exe]**

---

### **Event ID 11 â€” File Create / Write**
Triggered every second during log creation.

**Expected fields:**
- `TargetFilename: C:\Sandbox\logs\fake_keylog.txt`
- `ProcessGuid: python.exe`

ğŸ“¸ **[PLACEHOLDER â€” Sysmon EID 11 entries]**

---

# ğŸŸ¥ 5. Simulation 2 â€” Registry Persistence Behavior

### ğŸ“Œ Description  
PowerShell script simulating registry persistence by creating:
- A folder  
- A harmless EXE  
- A registry Run-like key  

### ğŸ“„ Script  
`fake_persistence_sim.ps1`

ğŸ“ **Created File:**  
`C:\Sandbox\bin\demo_app.exe`

ğŸ“¸ **[PLACEHOLDER â€” Script execution]**  
ğŸ“¸ **[PLACEHOLDER â€” demo_app.exe in bin folder]**  
ğŸ“¸ **[PLACEHOLDER â€” Registry path in regedit]**

---

## ğŸ” Sysmon Events for Persistence

### **Event ID 1 â€” Process Create**
PowerShell launching the script.

ğŸ“¸ **[PLACEHOLDER â€” EID 1 PowerShell]**

---

### **Event ID 11 â€” FileCreate**
Creation of `demo_app.exe`.

**Expected fields:**
- TargetFilename: `C:\Sandbox\bin\demo_app.exe`

ğŸ“¸ **[PLACEHOLDER â€” EID 11 demo_app.exe]**

---

### **Event ID 12 / 13 â€” Registry Changes**

- **EID 12** = Registry object create  
- **EID 13** = Registry value set  

Key created:
HKCU\Software\SandboxDemo\PersistenceDemo
DemoExecutable = C:\Sandbox\bin\demo_app.exe


ğŸ“¸ **[PLACEHOLDER â€” EID 13 screenshot]**

---

# ğŸŸ¨ 6. Simulation 3 â€” Beaconing Behavior

### ğŸ“Œ Description  
Python writes a â€œBEACON Xâ€ entry every 10 seconds for 30 cycles â€” replicating C2 beacon timing.

### ğŸ“„ Script  
`fake_beacon_sim.py`

ğŸ“ **Output:**  
`C:\Sandbox\logs\fake_beacon.txt`

ğŸ“¸ **[PLACEHOLDER â€” Script running]**  
ğŸ“¸ **[PLACEHOLDER â€” fake_beacon.txt growing]**

---

## ğŸ” Sysmon Events for Beacon

### **Event ID 1 â€” Process Create**
python.exe starting the beacon script.

ğŸ“¸ **[PLACEHOLDER â€” EID 1 python.exe]**

---

### **Event ID 11 â€” Regular File Writes**
Triggered every 10 seconds for each beacon write.

**Expected pattern:**
- 30 events
- ~10 seconds apart
- Source: python.exe  
- Target: `fake_beacon.txt`

ğŸ“¸ **[PLACEHOLDER â€” Repeated EID 11 timeline]**

---

# ğŸ“Š 7. Sysmon Event Summary Table

| Event ID | Meaning | Triggered By | Notes |
|---------|---------|--------------|-------|
| **1** | Process Create | Keylogger, Persistence, Beacon | python.exe / powershell.exe |
| **5** | Process Terminate | All scripts | Normal exit behavior |
| **11** | File Create / Write | Keylogger, Persistence, Beacon | Logs, demo_app.exe, beacon writes |
| **12** | Registry Object Create | Persistence | Key created |
| **13** | Registry Value Set | Persistence | Value written to key |

---

# ğŸ›¡ï¸ 8. Detection Opportunities

### ğŸŸ¦ Keylogger Simulation
- python.exe producing frequent file writes  
- Logs in user-controlled folder  
- Repetitive write patterns  

### ğŸŸ¥ Persistence Simulation
- PowerShell spawning writes under `HKCU`  
- Creation of executable in non-system directory  

### ğŸŸ¨ Beacon Simulation
- Long-running python.exe  
- Predictable timing intervals (10 seconds)  
- Sequential file writes  

---

# ğŸ§­ 9. Conclusion

This lab successfully replicates three core malware behaviors in a fully controlled and non-malicious environment. Using Sysmonâ€™s detailed telemetry, each stage of activity can be:

- monitored  
- detected  
- analyzed  
- documented  

This setup demonstrates real-world defensive and analytical skills, including:

- Windows internals  
- Malware behavior modeling  
- Endpoint detection engineering  
- Purple-team methodology  
