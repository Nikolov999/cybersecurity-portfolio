<#
fake_persistence_sim.ps1

This script simulates "persistence-like" behaviour in a SAFE way by:
- Creating a demo folder under C:\Sandbox\bin
- Copying itself there
- Writing a registry value under HKCU:\Software\SandboxDemo\PersistenceDemo

It does NOT modify real startup locations like Run/RunOnce. It is only for
generating registry modification events (Sysmon EID 13) and file events.
#>

param(
    [string]$DemoDir = "C:\Sandbox\bin",
    [string]$RegistryPath = "HKCU:\Software\SandboxDemo\PersistenceDemo",
    [string]$DemoValueName = "DemoExecutable",
    [string]$DemoTargetFile = "C:\Sandbox\bin\demo_app.exe"
)

Write-Host "[+] Creating demo directory at $DemoDir"
New-Item -ItemType Directory -Path $DemoDir -Force | Out-Null

# For demo, just create a small placeholder file
Write-Host "[+] Creating placeholder executable at $DemoTargetFile"
"THIS_IS_NOT_A_REAL_EXECUTABLE" | Out-File -FilePath $DemoTargetFile -Encoding ASCII -Force

Write-Host "[+] Creating demo registry key at $RegistryPath"
New-Item -Path $RegistryPath -Force | Out-Null

Write-Host "[+] Setting registry value $DemoValueName -> $DemoTargetFile"
Set-ItemProperty -Path $RegistryPath -Name $DemoValueName -Value $DemoTargetFile

Write-Host "[+] Done. You can now inspect Sysmon registry/file events."

